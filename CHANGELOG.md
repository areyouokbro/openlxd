# OpenLXD 更新日志

所有重要的项目变更都将记录在此文件中。

## [3.0.0-stage2] - 2026-01-04 - 第2阶段完成

### 🎉 重大更新

实现了完整的网络管理系统，包括IP地址池、NAT端口映射、反向代理功能。

### ✨ 新功能

- **IP地址池管理**
  - IPv4/IPv6 地址分配和释放
  - 地址池管理（添加/删除地址段）
  - 地址状态跟踪
  - 容器 IP 地址绑定

- **NAT端口映射**
  - 单端口映射
  - 端口段映射（批量映射）
  - 随机端口分配
  - iptables 规则自动管理
  - 端口可用性检查

- **反向代理**
  - Nginx 配置自动生成
  - 域名绑定到容器
  - SSL/HTTPS 支持
  - WebSocket 支持
  - 配置热重载

- **Web 管理界面**
  - IP地址池管理页面
  - 端口映射管理页面
  - 反向代理管理页面
  - 实时数据刷新

### 💾 数据库更新

- 新增 `ip_addresses` 表 - IP地址信息
- 新增 `port_mappings` 表 - 端口映射信息
- 新增 `proxy_configs` 表 - 反向代理配置

### 📦 API 接口

- `GET/POST/DELETE /api/network/ippool` - IP地址池管理
- `GET/POST/DELETE /api/network/portmapping` - 端口映射管理
- `GET/POST/PUT/DELETE /api/network/proxy` - 反向代理管理
- `GET /api/network/stats` - 网络统计信息

### 📈 项目进展

- 功能完整度：20% → 50%
- 代码行数：+2,050 行
- 二进制文件：15MB → 16MB

### 📝 已知限制

- 需要 root 权限执行 iptables 命令
- 反向代理功能需要安装 Nginx
- 不支持自动 SSL 证书（Let's Encrypt）
- 不支持负载均衡

---

## [3.0.0] - 2026-01-04 - 第1阶段完成

### 🎉 重大更新

这是一个完全重写的版本，移除了所有 Mock 数据，实现了真实的 LXD 集成。

### ✨ 新功能

- **真实 LXD 集成**
  - 使用 canonical/lxd 官方客户端库
  - 支持通过 Unix Socket 连接 LXD
  - 自动同步 LXD 容器到数据库
  - 实时获取容器状态和 IP 地址

- **模块化代码结构**
  - `internal/config` - 配置管理模块
  - `internal/models` - 数据库模型
  - `internal/lxd` - LXD 客户端封装
  - 清晰的代码组织，易于维护和扩展

- **完整的容器管理**
  - 创建容器（支持自定义 CPU、内存、磁盘）
  - 启动/停止/重启容器
  - 删除容器
  - 重置容器密码
  - 重装容器系统
  - 获取容器详情和实时状态

- **数据库系统**
  - SQLite 数据库支持
  - 自动数据库迁移
  - 容器信息持久化
  - 操作日志记录
  - 为网络配置和配额系统预留表结构

### 🔧 技术改进

- **编译优化**
  - 升级到 Go 1.21.13
  - 静态链接编译，无 glibc 依赖
  - 二进制文件大小优化（15MB）

- **配置系统**
  - 支持多路径配置文件查找
  - 数据库路径可配置
  - LXD Socket 路径可配置

- **安全性**
  - HTTPS 支持
  - 自签名证书自动生成
  - API 认证中间件
  - 管理员登录验证

### 🗑️ 移除内容

- 移除所有 Mock 数据和示例代码
- 移除不存在的内部包依赖
- 清理无用的代码和注释

### 📝 已知限制

这是第1阶段的完成版本，以下功能将在后续阶段实现：

- **第2阶段**：网络管理系统（独立IP、NAT、反向代理）
- **第3阶段**：配额限制系统
- **第4阶段**：实时监控和图表
- **第5阶段**：高级功能（VNC、热更新、DNS）

### 🐛 Bug 修复

- 修复配置文件路径查找问题
- 修复证书目录不存在的错误
- 修复 glibc 版本兼容性问题
- 修复 Web 界面 404 错误

---

## [2.0.0] - 2025-01-04

### 新增 ✨
- 完全开源的 LXD 容器管理后端
- RESTful API (100% 兼容原版)
- Web 管理界面
- 财务系统插件（WHMCS/魔方财务/FOSSBilling/SwapIDC）
- 一键安装脚本
- 管理工具 CLI (19项功能)
- 自动备份和健康检查
- 完整的文档系统

### 核心功能 🎯
- 容器生命周期管理
- 资源限制与配额控制
- 网络管理（NAT/IP池）
- 流量统计与控制
- 数据持久化（SQLite）
- 安全认证（API Key）

[3.0.0]: https://github.com/areyouokbro/openlxd/releases/tag/v3.0.0
[2.0.0]: https://github.com/areyouokbro/openlxd/releases/tag/v2.0.0
