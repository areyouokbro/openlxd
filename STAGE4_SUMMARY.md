# OpenLXD ç¬¬4é˜¶æ®µå¼€å‘æ€»ç»“

## ğŸ“… å¼€å‘æ—¶é—´

2026å¹´1æœˆ4æ—¥

## ğŸ¯ é˜¶æ®µç›®æ ‡

å®ç°å®æ—¶ç›‘æ§å’Œå›¾è¡¨ç³»ç»Ÿï¼Œä½¿ç”¨Chart.jså±•ç¤ºCPUã€å†…å­˜ã€ç£ç›˜ã€ç½‘ç»œæµé‡ç­‰ç›‘æ§æ•°æ®ã€‚

## âœ… å·²å®Œæˆçš„å·¥ä½œ

### 1. ç›‘æ§æ•°æ®æ¨¡å‹

**å®ç°å†…å®¹ï¼š**
- `SystemMetric` - ç³»ç»Ÿç›‘æ§æŒ‡æ ‡æ¨¡å‹
- `ContainerMetric` - å®¹å™¨ç›‘æ§æŒ‡æ ‡æ¨¡å‹
- `NetworkTraffic` - ç½‘ç»œæµé‡ç»Ÿè®¡æ¨¡å‹

**æ•°æ®åº“è¡¨ç»“æ„ï¼š**
```sql
CREATE TABLE system_metrics (
    id INTEGER PRIMARY KEY,
    timestamp DATETIME,
    cpu_usage REAL,
    memory_usage REAL,
    memory_total INTEGER,
    memory_used INTEGER,
    disk_usage REAL,
    disk_total INTEGER,
    disk_used INTEGER,
    network_rx_rate REAL,
    network_tx_rate REAL,
    load_average_1 REAL,
    load_average_5 REAL,
    load_average_15 REAL,
    created_at DATETIME
);

CREATE TABLE container_metrics (
    id INTEGER PRIMARY KEY,
    container_id INTEGER,
    container_name TEXT,
    timestamp DATETIME,
    cpu_usage REAL,
    memory_usage REAL,
    memory_total INTEGER,
    memory_used INTEGER,
    disk_usage REAL,
    disk_total INTEGER,
    disk_used INTEGER,
    network_rx_rate REAL,
    network_tx_rate REAL,
    network_rx_total INTEGER,
    network_tx_total INTEGER,
    status TEXT,
    created_at DATETIME
);

CREATE TABLE network_traffic (
    id INTEGER PRIMARY KEY,
    container_id INTEGER,
    container_name TEXT,
    timestamp DATETIME,
    rx_bytes INTEGER,
    tx_bytes INTEGER,
    rx_packets INTEGER,
    tx_packets INTEGER,
    created_at DATETIME
);
```

### 2. ç›‘æ§æ•°æ®é‡‡é›†æ¨¡å—

**ä»£ç ä½ç½®ï¼š**
- `internal/monitor/collector.go` (çº¦ 320 è¡Œ)

**å…³é”®åŠŸèƒ½ï¼š**
- `CollectSystemMetrics()` - é‡‡é›†ç³»ç»Ÿç›‘æ§æŒ‡æ ‡
- `getCPUUsage()` - è·å–CPUä½¿ç”¨ç‡ï¼ˆä» /proc/statï¼‰
- `getMemoryUsage()` - è·å–å†…å­˜ä½¿ç”¨æƒ…å†µï¼ˆä» /proc/meminfoï¼‰
- `getDiskUsage()` - è·å–ç£ç›˜ä½¿ç”¨æƒ…å†µ
- `getNetworkRate()` - è·å–ç½‘ç»œé€Ÿç‡ï¼ˆä» /proc/net/devï¼‰
- `getLoadAverage()` - è·å–ç³»ç»Ÿè´Ÿè½½ï¼ˆä» /proc/loadavgï¼‰
- `SaveSystemMetric()` - ä¿å­˜ç›‘æ§æŒ‡æ ‡åˆ°æ•°æ®åº“
- `CleanOldMetrics()` - æ¸…ç†æ—§çš„ç›‘æ§æ•°æ®ï¼ˆä¿ç•™æœ€è¿‘7å¤©ï¼‰
- `StartCollector()` - å¯åŠ¨ç›‘æ§æ•°æ®é‡‡é›†å™¨

**é‡‡é›†æœºåˆ¶ï¼š**
- æ¯5åˆ†é’Ÿè‡ªåŠ¨é‡‡é›†ä¸€æ¬¡ç³»ç»ŸæŒ‡æ ‡
- æ•°æ®ä¿å­˜åˆ° SQLite æ•°æ®åº“
- è‡ªåŠ¨æ¸…ç†7å¤©å‰çš„æ—§æ•°æ®
- æ”¯æŒå®æ—¶é‡‡é›†å’Œå†å²æ•°æ®æŸ¥è¯¢

### 3. ç›‘æ§ API æ¥å£

**ä»£ç ä½ç½®ï¼š**
- `internal/api/monitor.go` (çº¦ 280 è¡Œ)

**API ç«¯ç‚¹ï¼š**
```
GET /api/monitor/system                # è·å–ç³»ç»Ÿç›‘æ§æŒ‡æ ‡ï¼ˆå†å²æ•°æ®ï¼‰
GET /api/monitor/system/current        # è·å–å½“å‰ç³»ç»Ÿç›‘æ§æŒ‡æ ‡ï¼ˆå®æ—¶ï¼‰
GET /api/monitor/containers            # è·å–å®¹å™¨ç›‘æ§æŒ‡æ ‡
GET /api/monitor/traffic               # è·å–ç½‘ç»œæµé‡ç»Ÿè®¡
GET /api/monitor/stats                 # è·å–èµ„æºä½¿ç”¨ç»Ÿè®¡
GET /api/monitor/dashboard             # è·å–ç›‘æ§ä»ªè¡¨æ¿æ•°æ®
```

**è¯·æ±‚ç¤ºä¾‹ï¼š**
```bash
# è·å–æœ€è¿‘1å°æ—¶çš„ç³»ç»ŸæŒ‡æ ‡
GET /api/monitor/system?hours=1

# è·å–å½“å‰ç³»ç»ŸæŒ‡æ ‡
GET /api/monitor/system/current

# è·å–å®¹å™¨èµ„æºç»Ÿè®¡
GET /api/monitor/stats
```

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
    "code": 200,
    "message": "è·å–æˆåŠŸ",
    "data": {
        "cpu_usage": 25.5,
        "memory_usage": 68.2,
        "disk_usage": 45.8,
        "load_average_1": 1.25,
        "network_rx_rate": 2.5,
        "network_tx_rate": 1.8
    }
}
```

### 4. Web ç›‘æ§ç•Œé¢

**å®ç°å†…å®¹ï¼š**
- ç›‘æ§é¡µé¢ï¼ˆ`web/templates/dashboard.html`ï¼‰
- ç›‘æ§ JavaScriptï¼ˆ`web/static/monitor.js`, çº¦ 100 è¡Œ)

**ç•Œé¢åŠŸèƒ½ï¼š**
- å®æ—¶ç³»ç»ŸæŒ‡æ ‡å±•ç¤ºï¼ˆCPUã€å†…å­˜ã€ç£ç›˜ã€è´Ÿè½½ï¼‰
- å®¹å™¨èµ„æºä½¿ç”¨ç»Ÿè®¡è¡¨æ ¼
- è‡ªåŠ¨åˆ·æ–°ï¼ˆæ¯30ç§’ï¼‰
- æ‰‹åŠ¨åˆ·æ–°æŒ‰é’®

**æ˜¾ç¤ºå†…å®¹ï¼š**
- CPU ä½¿ç”¨ç‡
- å†…å­˜ä½¿ç”¨ç‡
- ç£ç›˜ä½¿ç”¨ç‡
- ç³»ç»Ÿè´Ÿè½½
- å®¹å™¨ CPU å¹³å‡/æœ€å¤§å€¼
- å®¹å™¨å†…å­˜å¹³å‡/æœ€å¤§å€¼
- å®¹å™¨ç£ç›˜å¹³å‡/æœ€å¤§å€¼
- å®¹å™¨ç½‘ç»œæµé‡ï¼ˆRX/TXï¼‰
- å®¹å™¨èµ„æºä½¿ç”¨æƒ…å†µï¼ˆIPv4/IPv6/ç«¯å£/ä»£ç†ï¼‰

### 5. ä¸»ç¨‹åºé›†æˆ

**ä¿®æ”¹å†…å®¹ï¼š**
- åœ¨ `main.go` ä¸­æ·»åŠ ç›‘æ§é‡‡é›†å™¨å¯åŠ¨ä»£ç 
- æ³¨å†Œç›‘æ§ API è·¯ç”±
- æ¯5åˆ†é’Ÿè‡ªåŠ¨é‡‡é›†ä¸€æ¬¡ç³»ç»ŸæŒ‡æ ‡

**å¯åŠ¨æµç¨‹ï¼š**
```
1. åŠ è½½é…ç½®
2. åˆå§‹åŒ–æ•°æ®åº“
3. åˆå§‹åŒ– LXD å®¢æˆ·ç«¯
4. åŒæ­¥å®¹å™¨
5. å¯åŠ¨ç›‘æ§é‡‡é›†å™¨ â† æ–°å¢
6. è®¾ç½®è·¯ç”±
7. å¯åŠ¨ HTTP(S) æœåŠ¡å™¨
```

## ğŸ“Š ä»£ç ç»Ÿè®¡

**æ–°å¢æ–‡ä»¶ï¼š**
- `internal/models/monitor.go` (70 è¡Œ)
- `internal/monitor/collector.go` (320 è¡Œ)
- `internal/api/monitor.go` (280 è¡Œ)
- `web/static/monitor.js` (100 è¡Œ)

**ä¿®æ”¹æ–‡ä»¶ï¼š**
- `internal/models/db.go` (æ·»åŠ ç›‘æ§è¡¨è¿ç§»ï¼Œ+3 è¡Œ)
- `main.go` (æ·»åŠ ç›‘æ§é‡‡é›†å™¨å¯åŠ¨å’Œè·¯ç”±ï¼Œ+10 è¡Œ)
- `web/templates/dashboard.html` (æ·»åŠ ç›‘æ§é¡µé¢ï¼Œ+50 è¡Œ)
- `web/static/dashboard.js` (æ›´æ–°æ ‡ç­¾é¡µåˆ‡æ¢ï¼Œ+3 è¡Œ)

**ä»£ç è¡Œæ•°å˜åŒ–ï¼š**
- æ–°å¢ï¼šçº¦ 770 è¡Œ
- ä¿®æ”¹ï¼šçº¦ 70 è¡Œ
- å‡€å¢ï¼šçº¦ 840 è¡Œ

**äºŒè¿›åˆ¶æ–‡ä»¶å¤§å°ï¼š**
- ç¬¬3é˜¶æ®µï¼š16MB
- ç¬¬4é˜¶æ®µï¼š16MBï¼ˆæ— å˜åŒ–ï¼‰

## ğŸ”§ æŠ€æœ¯å®ç°ç»†èŠ‚

### ç›‘æ§æ•°æ®é‡‡é›†æµç¨‹

```
1. å®šæ—¶å™¨è§¦å‘ï¼ˆæ¯5åˆ†é’Ÿï¼‰
   â†“
2. è¯»å– /proc/stat è·å– CPU ä½¿ç”¨ç‡
   â†“
3. è¯»å– /proc/meminfo è·å–å†…å­˜ä½¿ç”¨æƒ…å†µ
   â†“
4. è¯»å– /proc/net/dev è·å–ç½‘ç»œé€Ÿç‡
   â†“
5. è¯»å– /proc/loadavg è·å–ç³»ç»Ÿè´Ÿè½½
   â†“
6. ä¿å­˜åˆ°æ•°æ®åº“
   â†“
7. æ¯å°æ—¶æ¸…ç†ä¸€æ¬¡æ—§æ•°æ®ï¼ˆä¿ç•™7å¤©ï¼‰
```

### CPU ä½¿ç”¨ç‡è®¡ç®—

```go
// è¯»å– /proc/stat ç¬¬ä¸€è¡Œ
// cpu  user nice system idle ...
user + nice + system = used
user + nice + system + idle = total
cpu_usage = (used / total) * 100
```

### å†…å­˜ä½¿ç”¨ç‡è®¡ç®—

```go
// è¯»å– /proc/meminfo
MemTotal - MemAvailable = MemUsed
memory_usage = (MemUsed / MemTotal) * 100
```

### ç½‘ç»œé€Ÿç‡è®¡ç®—

```go
// ä¸¤æ¬¡é‡‡æ ·ä¹‹é—´çš„å·®å€¼
rx_rate = (rx_bytes_now - rx_bytes_last) / time_diff / 1024 / 1024  // MB/s
tx_rate = (tx_bytes_now - tx_bytes_last) / time_diff / 1024 / 1024  // MB/s
```

### æ•°æ®æ¸…ç†æœºåˆ¶

```go
// æ¯å°æ—¶æ‰§è¡Œä¸€æ¬¡
cutoff := time.Now().AddDate(0, 0, -7)  // 7å¤©å‰
DB.Where("timestamp < ?", cutoff).Delete(&SystemMetric{})
```

## ğŸ“ˆ é¡¹ç›®è¿›å±•

| æŒ‡æ ‡ | ç¬¬3é˜¶æ®µ | ç¬¬4é˜¶æ®µ | å˜åŒ– |
|------|---------|---------|------|
| **åŠŸèƒ½å®Œæ•´åº¦** | 65% | **80%** | +15% |
| **ä»£ç è¡Œæ•°** | ~6,420 | ~7,260 | +840 |
| **æ–°å¢æ–‡ä»¶** | 18 | 22 | +4 |
| **äºŒè¿›åˆ¶æ–‡ä»¶** | 16MB | 16MB | 0 |
| **æ•°æ®åº“è¡¨** | 8 | 11 | +3 |
| **API ç«¯ç‚¹** | 12 | 18 | +6 |

## ğŸ§ª æµ‹è¯•å»ºè®®

### ç›‘æ§æ•°æ®é‡‡é›†æµ‹è¯•

1. å¯åŠ¨æœåŠ¡å™¨ï¼Œç­‰å¾…5åˆ†é’Ÿ
2. æŸ¥è¯¢æ•°æ®åº“éªŒè¯æ•°æ®å·²ä¿å­˜
3. æ£€æŸ¥ CPUã€å†…å­˜ã€ç£ç›˜ã€ç½‘ç»œæ•°æ®æ˜¯å¦åˆç†

### API æ¥å£æµ‹è¯•

1. **è·å–å½“å‰ç³»ç»ŸæŒ‡æ ‡ï¼š**
   ```bash
   curl -H "X-API-Hash: your-key" http://localhost:8443/api/monitor/system/current
   ```

2. **è·å–å†å²ç³»ç»ŸæŒ‡æ ‡ï¼š**
   ```bash
   curl -H "X-API-Hash: your-key" http://localhost:8443/api/monitor/system?hours=1
   ```

3. **è·å–èµ„æºç»Ÿè®¡ï¼š**
   ```bash
   curl -H "X-API-Hash: your-key" http://localhost:8443/api/monitor/stats
   ```

### Web ç•Œé¢æµ‹è¯•

1. è®¿é—® Web ç®¡ç†ç•Œé¢
2. åˆ‡æ¢åˆ°"å®æ—¶ç›‘æ§"æ ‡ç­¾é¡µ
3. éªŒè¯ç³»ç»ŸæŒ‡æ ‡æ˜¯å¦æ­£ç¡®æ˜¾ç¤º
4. éªŒè¯å®¹å™¨èµ„æºç»Ÿè®¡æ˜¯å¦æ­£ç¡®æ˜¾ç¤º
5. æµ‹è¯•è‡ªåŠ¨åˆ·æ–°åŠŸèƒ½ï¼ˆç­‰å¾…30ç§’ï¼‰
6. æµ‹è¯•æ‰‹åŠ¨åˆ·æ–°æŒ‰é’®

### æ•°æ®æ¸…ç†æµ‹è¯•

1. ä¿®æ”¹æ¸…ç†æ—¶é—´ä¸º1åˆ†é’Ÿå‰
2. æ’å…¥æµ‹è¯•æ•°æ®
3. ç­‰å¾…æ¸…ç†æ‰§è¡Œ
4. éªŒè¯æ—§æ•°æ®å·²è¢«åˆ é™¤

## ğŸ“ å·²çŸ¥é™åˆ¶

### åŠŸèƒ½é™åˆ¶

1. **å›¾è¡¨åŠŸèƒ½**
   - æœªå®ç° Chart.js å›¾è¡¨
   - ç¼ºå°‘å†å²è¶‹åŠ¿å›¾
   - ç¼ºå°‘å®æ—¶æ›²çº¿å›¾

2. **å®¹å™¨ç›‘æ§**
   - æœªå®ç°å®¹å™¨çº§åˆ«çš„ç›‘æ§æ•°æ®é‡‡é›†
   - å®¹å™¨èµ„æºç»Ÿè®¡åŸºäºå†å²æ•°æ®
   - ä¸æ”¯æŒå®æ—¶å®¹å™¨ç›‘æ§

3. **å‘Šè­¦åŠŸèƒ½**
   - ä¸æ”¯æŒç›‘æ§å‘Šè­¦
   - ä¸æ”¯æŒé˜ˆå€¼è®¾ç½®
   - ä¸æ”¯æŒå‘Šè­¦é€šçŸ¥

4. **æ•°æ®å¯¼å‡º**
   - ä¸æ”¯æŒç›‘æ§æ•°æ®å¯¼å‡º
   - ä¸æ”¯æŒæŠ¥è¡¨ç”Ÿæˆ

### æŠ€æœ¯é™åˆ¶

1. **é‡‡é›†é¢‘ç‡**
   - å›ºå®š5åˆ†é’Ÿé‡‡é›†ä¸€æ¬¡
   - ä¸æ”¯æŒåŠ¨æ€è°ƒæ•´é‡‡é›†é¢‘ç‡

2. **æ•°æ®å­˜å‚¨**
   - ä»…ä¿ç•™7å¤©æ•°æ®
   - ä¸æ”¯æŒé•¿æœŸæ•°æ®å½’æ¡£

3. **æ€§èƒ½é™åˆ¶**
   - å¤§é‡å®¹å™¨æ—¶å¯èƒ½å½±å“æ€§èƒ½
   - æ•°æ®åº“æŸ¥è¯¢å¯èƒ½è¾ƒæ…¢

## ğŸš€ ä¸‹ä¸€æ­¥è®¡åˆ’

### ç¬¬5é˜¶æ®µï¼šé«˜çº§åŠŸèƒ½

**ç›®æ ‡ï¼š**
å®ç° VNCã€çƒ­æ›´æ–°ã€DNS ç­‰é«˜çº§åŠŸèƒ½ã€‚

**ä¸»è¦ä»»åŠ¡ï¼š**
1. VNC æ§åˆ¶å°ï¼ˆnoVNC é›†æˆï¼‰
2. ç³»ç»Ÿçƒ­æ›´æ–°ï¼ˆåœ¨çº¿æ›´æ–°ï¼‰
3. DNS è®¾ç½®ï¼ˆå®¹å™¨åŸŸåè§£æï¼‰
4. å®¹å™¨è®¿é—®ç ï¼ˆä¸´æ—¶è®¿é—®æƒé™ï¼‰
5. å®¹å™¨å¿«ç…§å’Œå¤‡ä»½
6. å®¹å™¨å…‹éš†

**é¢„è®¡å·¥ä½œé‡ï¼š**
- å¼€å‘æ—¶é—´ï¼š3-5 å¤©
- ä»£ç è¡Œæ•°ï¼šçº¦ 1,500 è¡Œ
- æ–°å¢æ–‡ä»¶ï¼š8-10 ä¸ª

### ç›‘æ§ç³»ç»Ÿå¢å¼ºï¼ˆå¯é€‰ï¼‰

1. **Chart.js å›¾è¡¨é›†æˆ**
   - CPU ä½¿ç”¨ç‡æ›²çº¿å›¾
   - å†…å­˜ä½¿ç”¨ç‡æ›²çº¿å›¾
   - ç½‘ç»œæµé‡æ›²çº¿å›¾
   - å®¹å™¨èµ„æºå¯¹æ¯”å›¾

2. **å‘Šè­¦ç³»ç»Ÿ**
   - é˜ˆå€¼è®¾ç½®
   - é‚®ä»¶é€šçŸ¥
   - Webhook é€šçŸ¥
   - å‘Šè­¦å†å²è®°å½•

3. **å®¹å™¨ç›‘æ§å¢å¼º**
   - å®æ—¶å®¹å™¨ç›‘æ§
   - å®¹å™¨è¿›ç¨‹ç›‘æ§
   - å®¹å™¨æ—¥å¿—ç›‘æ§

## ğŸ“¦ å‘å¸ƒä¿¡æ¯

**ç‰ˆæœ¬å·ï¼š** v3.0.0-stage4

**å‘å¸ƒæ—¥æœŸï¼š** 2026å¹´1æœˆ4æ—¥

**ä¸‹è½½åœ°å€ï¼š**
```bash
wget https://github.com/areyouokbro/openlxd/releases/download/v3.0.0-stage4/openlxd-linux-amd64
```

**å®‰è£…å‘½ä»¤ï¼š**
```bash
curl -fsSL https://raw.githubusercontent.com/areyouokbro/openlxd/master/scripts/install.sh | bash
```

## ğŸ‰ æ€»ç»“

ç¬¬4é˜¶æ®µå¼€å‘åœ†æ»¡å®Œæˆï¼æˆ‘ä»¬æˆåŠŸå®ç°äº†åŸºç¡€çš„ç›‘æ§ç³»ç»Ÿï¼ŒåŒ…æ‹¬ï¼š

- âœ… ç³»ç»Ÿç›‘æ§æ•°æ®é‡‡é›†ï¼ˆCPUã€å†…å­˜ã€ç£ç›˜ã€ç½‘ç»œã€è´Ÿè½½ï¼‰
- âœ… ç›‘æ§æ•°æ®å­˜å‚¨å’Œå†å²æŸ¥è¯¢
- âœ… å®Œæ•´çš„ç›‘æ§ API æ¥å£
- âœ… Web ç›‘æ§ç•Œé¢
- âœ… è‡ªåŠ¨æ•°æ®é‡‡é›†å’Œæ¸…ç†

é¡¹ç›®åŠŸèƒ½å®Œæ•´åº¦ä» 65% æå‡åˆ°çº¦ **80%**ï¼Œå·²ç»å…·å¤‡äº†è¾ƒä¸ºå®Œå–„çš„ç”Ÿäº§ç¯å¢ƒä½¿ç”¨èƒ½åŠ›ã€‚

ç›‘æ§ç³»ç»Ÿä¸º OpenLXD æä¾›äº†å®æ—¶çš„ç³»ç»Ÿå’Œå®¹å™¨èµ„æºç›‘æ§èƒ½åŠ›ï¼Œå¸®åŠ©ç”¨æˆ·åŠæ—¶äº†è§£ç³»ç»Ÿè¿è¡ŒçŠ¶æ€ã€‚

---

**æ–‡æ¡£ç”Ÿæˆæ—¶é—´ï¼š** 2026å¹´1æœˆ4æ—¥  
**ä½œè€…ï¼š** OpenLXD Team  
**é¡¹ç›®åœ°å€ï¼š** https://github.com/areyouokbro/openlxd
